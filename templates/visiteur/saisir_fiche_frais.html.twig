{% extends 'visiteur/index.html.twig' %}

{% block contenuPage %}

	<h1>Saisie</h1>
	<h3>Période d'engagement</h3>
	<h4>{{ficheFrais.mois | format_datetime(locale='fr',pattern="MMMM YYYY") | capitalize}}</h4>
	<br/>

	<h3>Frais au forfait</h3>
	<div class="table-responsive">
		<table class="table table-bordered table-active table-hover table-striped table-responsive">
			<thead class="thead-dark"></thead>
			<tr class="table-secondary">
				<th>Frais forfait</th>
				<th>Forfait Etape</th>
				<th>Frais Kilométrique</th>
				<th>Nuitée Hôtel</th>
				<th>Repas Restaurant</th>
			</tr>
			<tbody>
				<tr>
					<td>Montant</td>
					{% for unFraisForfait in fraisForfaits %}
						<td>{{unFraisForfait.montant}}</td>
					{% endfor %}
				</tr>
				<tr>
					<td>Quantité</td>
					{% for unFraisForfait in fraisForfaits %}
						{# {% set quantite = 0 %} #}
						<td>
							{% for ligneFraisForfait in ligneFraisForfaits %}

								{% if unFraisForfait == ligneFraisForfait.fraisForfait %}
									{{ligneFraisForfait.quantite }}
								{% endif %}

							{% endfor %}
						</td>
					{% endfor %}
				</tr>
				<tr>
					<td>Total</td>
					{% for unFraisForfait in fraisForfaits %}
						<td>
							{% for ligneFraisForfait in ligneFraisForfaits %}

								{% if unFraisForfait == ligneFraisForfait.fraisForfait %}
									{{unFraisForfait.montant * ligneFraisForfait.quantite}}
								{% endif %}

							{% endfor %}
						</td>
					{% endfor %}
				</tr>
			</tbody>
		</table>
	</div>

	{{form_start(formFraisForfait, {'attr': {'class': "row g-3", 'onsubmit': "return confirm('Souhaitez-vous valider les nouvelles quantités de frais forfaitisés ?');"}}
	)}}
	<div class="col-md-3">
		<label for="fraisForfait" class="form-label">Forfait Etape</label>
		{{form_widget(formFraisForfait.lignefraisforfaits.ETP.quantite)}}
	</div>
	<div class="col-md-3">
		<label for="fraisForfait" class="form-label">Frais Kilométrique</label>
		{{form_widget(formFraisForfait.lignefraisforfaits.KM.quantite)}}
	</div>
	<div class="col-md-3">
		<label for="fraisForfait" class="form-label">Nuitée Hôtel</label>
		{{form_widget(formFraisForfait.lignefraisforfaits.NUI.quantite)}}
	</div>
	<div class="col-md-3">
		<label for="fraisForfait" class="form-label">Repas Restaurant</label>
		{{form_widget(formFraisForfait.lignefraisforfaits.REP.quantite)}}
	</div>
	<div class="col-12">
		<button type="submit" class="btn btn-primary">Valider</button>
	</div>
	{{form_end(formFraisForfait)}}
	<br/>

	<h3>Frais hors forfait</h3>
	<div class="table-responsive">
		<table class="table table-bordered table-active table-hover table-striped">
			<thead class="thead-dark"></thead>
			<tr class="table-secondary">
				<th>Date</th>
				<th>Libelle</th>
				<th>Montant</th>
				<th>Action</th>
			</tr>
			<tbody>
				{% for unFraisHorsForfait in fraisHorsForfaits %}
					<tr>
						{# {{dump(fraisHorsForfaits)}} #}
						<td class="align-middle">{{unFraisHorsForfait.date | date('d/m/Y')}}</td>
						<td class="align-middle">{{unFraisHorsForfait.libelle}}</td>
						<td class="align-middle">{{unFraisHorsForfait.montant}}</td>
						<td class="col-md-1">
							<form method="post" action="{{ path('supprimer_fraishorsforfait', {'id': unFraisHorsForfait.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette ligne de frais non forfaitisé ?');">
								<input type="hidden" name="supprimer_fraishorsforfait_token" value="{{ csrf_token('delete' ~ unFraisHorsForfait.id) }}">
								<button class="btn btn-primary btn-sm">Supprimer</button>
							</form>
						</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

	{{form_start(formFraisHorsForfait, {'attr': {'class': "row g-3", 'onsubmit': "return confirm('Souhaitez-vous ajouter un nouveau frais non forfaitisé ?');"}})}}
	<div class="col-md-4">
		<label for="fraisHorForfait" class="form-label">Date</label>
		{{form_widget(formFraisHorsForfait.date)}}
	</div>
	<div class="col-md-4">
		<label for="fraisHorForfait" class="form-label">Libelle</label>
		{{form_widget(formFraisHorsForfait.libelle)}}
	</div>
	<div class="col-md-4">
		<label for="fraisHorForfait" class="form-label">Montant</label>
		{{form_widget(formFraisHorsForfait.montant)}}
	</div>
	<div class="col-12">
		{{form_row(formFraisHorsForfait.ajouter)}}
	</div>
	{{form_end(formFraisHorsForfait)}}
	<br/>

	{# <h3>Hors classfication</h3>
		{{form_row(formFichefrais.nbjustificatifs)}}
		{{form_row(formFichefrais.montantvalide)}} #}
{% endblock %}
